From 8d9b0f1d930a0b04ac76641f447f0b59d709d734 Mon Sep 17 00:00:00 2001
From: Michael Krummsdorf <michael.krummsdorf@tqs.de>
Date: Wed, 28 May 2014 14:42:13 +0200
Subject: [PATCH] tqma28x: select ref_pix as lcdif parent clock

Signed-off-by: Michael Krummsdorf <michael.krummsdorf@tqs.de>
---
 arch/arm/mach-mxs/mach-mxs.c |    7 +++++++
 drivers/clk/mxs/clk-imx28.c  |    2 ++
 2 files changed, 9 insertions(+)

diff --git a/arch/arm/mach-mxs/mach-mxs.c b/arch/arm/mach-mxs/mach-mxs.c
index dae56c0..3052d7f 100644
--- a/arch/arm/mach-mxs/mach-mxs.c
+++ b/arch/arm/mach-mxs/mach-mxs.c
@@ -340,9 +340,16 @@ static void __init tqma28_init(void)
 	unsigned long oc;
 	struct device_node *np;
 	void __iomem *addr;
+	struct clk *ref_pix, *lcdif_sel;
 
 	enable_clk_enet_out();
 	/* TODO: update_fec_mac_prop(OUI_TQS); */
+	lcdif_sel = clk_get_sys(NULL, "lcdif_sel");
+	ref_pix = clk_get_sys(NULL, "ref_pix");
+	if (IS_ERR(lcdif_sel) || IS_ERR(ref_pix))
+		pr_err("Error on selecting LCD-IF clock.\n");
+	else
+		clk_set_parent(lcdif_sel, ref_pix);
 
 	/*
 	 * enable usb overcurrent detection logic in MX28 HW_DIGCTL_CTRL_SET
diff --git a/drivers/clk/mxs/clk-imx28.c b/drivers/clk/mxs/clk-imx28.c
index a6c3501..2226eca 100644
--- a/drivers/clk/mxs/clk-imx28.c
+++ b/drivers/clk/mxs/clk-imx28.c
@@ -248,6 +248,8 @@ static void __init mx28_clocks_init(struct device_node *np)
 	of_clk_add_provider(np, of_clk_src_onecell_get, &clk_data);
 
 	clk_register_clkdev(clks[enet_out], NULL, "enet_out");
+	clk_register_clkdev(clks[lcdif_sel], "lcdif_sel", NULL);
+	clk_register_clkdev(clks[ref_pix], "ref_pix", NULL);
 
 	for (i = 0; i < ARRAY_SIZE(clks_init_on); i++)
 		clk_prepare_enable(clks[clks_init_on[i]]);
-- 
1.7.10.4

